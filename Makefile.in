srcdir = @srcdir@
VPATH = $(srcdir)

LIBOBJECTS = 	popt.o

WARNINGS = -Wall -Wpointer-arith -Wstrict-prototypes -Wmissing-prototypes 

SOURCES = $(addprefix $(srcdir)/,$(subst .o,.c,$(LIBOBJECTS)))
LIBPOPT = libpopt.a

prefix=@prefix@
LIBS=$(prefix)/lib
INCLUDE=$(prefix)/include

# -----------------------------------------------------------------------

CFLAGS = @CFLAGS@ @DEFS@ $(WARNINGS) $(OPTS)

ifeq ($(RANLIB),)
RANLIB=ranlib
endif

ifeq (.depend,$(wildcard .depend))
TARGET=allprogs
else
TARGET=depend allprogs
endif

$(LIBPOPT): $(LIBPOPT)($(LIBOBJECTS))
	$(RANLIB) $@

distclean: clean
	rm -f Makefile config.h config.cache config.status config.log

clean:
	rm -f *.a *.o *~ $(PROGS) test.out tagtable.c

squeaky: clean
	rm -f .depend

depend:
	$(CPP) $(CFLAGS) -M $(SOURCES) > .depend

install:
	mkdir -p $(PREFIX)/$(INCLUDE)
	mkdir -p $(PREFIX)/$(LIBS)
	install -m 644 popt.h $(PREFIX)/$(INCLUDE)/popt.h
	install -m 644 $(LIBPOPT) $(PREFIX)/$(LIBS)/$(LIBPOPT)

ifeq (.depend,$(wildcard .depend))
include .depend
endif
